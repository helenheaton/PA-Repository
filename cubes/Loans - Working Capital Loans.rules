SKIPCHECK;
FEEDSTRINGS;

['Interest']=N:
  (['Opening Balance']*
  DB('Loans - Assumptions', !Version, 'Working Capital Interest Rate' ))/
  IF(MOD( Numbr(Attrs('t_Year',!t_Year,'Financial Year'))+1,  4 )=0,
  Attrn('t_Period','FY','Number of Days'),
  Attrn('t_Period','FY','Number of Days'))
  *
  IF(MOD( Numbr(Attrs('t_Year',!t_Year,'Financial Year'))+1,  4 )=0,
  Attrn('t_Period',!t_Period,'Number of Days Leap'),
  Attrn('t_Period',!t_Period,'Number of Days'))
  ;
  
  
['Opening Balance','April']=N:STET;


['Opening Balance']=N:
DB('Loans - Working Capital Loans', !Version, Attrs('t_Period', !t_Period, 'Previous Period'), !t_Year, !Entity, !'Loaning Entity', 'Closing Balance' );


[{'Opening Balance','Closing Balance'}]=C:
IF(Ellev('t_Period',!t_Period)<>0,
DB('Loans - Working Capital Loans', !Version, ELCOMP('t_Period', !t_Period, ELCOMPN( 't_Period', !t_Period )), !t_Year, !Entity, !'Loaning Entity', !m_Loans Working Capital)
,CONTINUE);


['Interest Repayment']=N:-['Interest'];


  
FEEDERS;

# Internal Feeders

['Opening Balance']=>['Interest'];

['Closing Balance']=>DB('Loans - Working Capital Loans', !Version, Attrs('t_Period', !t_Period, 'Next Period'), !t_Year, !Entity, !'Loaning Entity', 'Opening Balance' );

['Interest']=>['Interest Repayment'];

# External Feeders

['Interest']=>DB('Loans by Entity', !Version, !t_Period, !t_Year, !Entity, 
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Cost Department' ), 
!'Loaning Entity','Working Capital',
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Cost Nominal Code'), 
'PL Interest' );

['Interest']=>DB('Loans by Entity', !Version, !t_Period, !t_Year, !Entity, 
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Cost Department' ),  
!'Loaning Entity', 'Working Capital',
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Cost Nominal Code'), 
'Cash Interest Repayments' );


['Interest']=>DB('Loans by Entity', !Version, !t_Period, !t_Year, !Entity, 
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Internal Income Department' ), 
!'Loaning Entity','Working Capital',
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Internal Income Nominal Code'), 
'Internal PL Income' );

['Interest']=>DB('Loans by Entity', !Version, !t_Period, !t_Year, !Entity, 
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Internal Income Department' ),  
!'Loaning Entity', 'Working Capital',
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Internal Income Nominal Code'), 
'Internal Cash Income' );


['Interest']=>DB('Loans by Entity', !Version, !t_Period, !t_Year, !Entity, 
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Cost Department' ), 
!'Loaning Entity','Working Capital',
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Cost Nominal Code'), 
'Capital Repayments' );

['Additional Loans']=>DB('Loans by Entity', !Version, !t_Period, !t_Year, !Entity, 
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Cost Department' ), 
!'Loaning Entity','Working Capital',
DB('Loans - Lookup', !Entity, !'Loaning Entity', 'WC Cost Nominal Code'), 
'Capital Repayments' );
