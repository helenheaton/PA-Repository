SKIPCHECK;
FEEDSTRINGS;

# All of the Variable base charges relate to care (cost type) only so doesnâ€™t need a cost type dim.


# Can't populate in contracts which don't have a care provider
['Amount']=N: IF(Attrs('Contract',!Contract, 'Care Provider')@='',0,CONTINUE);


# Bring in index value
# Multiply it by the pre 2010 index
['Index']=N: 
 DB('Admin - Index Rates', !t_Financial Year, !Contract, 
 DB('Subcontract - Index Lookup',!Contract,'Care AEI','Index'));



# Calculated amount 
['Calculated Value']=N:
['Amount']*(['Index']);

# Higher levels can reverse the calc so the % is always right
['Index']=C:
(['Calculated Value']-['Amount'])\['Amount'];


FEEDERS;

# Indirect Feeder, index only needs feeding if there is an amount
['Amount']=>['Index'];

['Amount']=>['Calculated Value'];

# Feeding from Amount instead of Calculated value as Amount is the source for Calc value.
['Amount']=>DB('Subcontract - Calculation', !Version, 'FY', !t_Financial Year, !Department, !Contract, 'Care AEI', 'Value');